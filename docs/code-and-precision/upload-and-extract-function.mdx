---
sidebar_position: 2
---

# Upload and extract function

<head>
  <meta property="og:image" content="https://p-u.vercel.app/assets/meta_visual.png" />
  <meta name="og:url" content="https://polyuploader.vercel.app/code-and-precision/upload-and-extract-function" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://p-u.vercel.app/assets/meta_visual.png" />
  <meta name="og:description" content="Upload and extract function - PolyUploader. Upload your files remotely to different hosting sites." />
  <meta name="theme-color" content="#4f46e5" />
</head>

Allows you to send a file to a file host, extract the download link and, if required, manage the manual deletion of the file.

## ğŸ§  Function overview

```js
function upload_to_host(request_data, response_format, link_extraction = [], affix = [], manage_file = []) {
  // ...
}
```

## ğŸ“¦ Parameters explained

### ğŸ“ `request_data`

The base configuration for the HTTP request to the host:

- `request_data[0]` â†’ Endpoint URL
- `request_data[1]` â†’ HTTP method (`"POST"`, `"GET"`â€¦)
- `request_data[2]` â†’ Body of the request (e.g. a `FormData` object)
- `request_data[3]` â†’ Optional headers (e.g. `{ "Content-Type": "application/json" }`)

### ğŸ“¬ `response_format`

Type of response expected from the server:

- `"json"` â†’ if the server returns a JSON object
- `"text"` â†’ if the server returns plain text or HTML

### ğŸ”— `link_extraction`

Rules to extract the download link from the serverâ€™s response:

- ğŸ”¹ Static:
  `["https://example.com/" + code]` â€” build the link manually
- ğŸ”¹ Regex match:
  `["match", /regex/, index]` â€” extract using a rege
- ğŸ”¹ Replace:
  `["replace", "&", "_"]` â€” replace characters in a string
- ğŸ”¹ JSON path:
  `["data", "downloadPage"]` â†’ will return `data["data"]["downloadPage"]`

### ğŸ§© `affix`

Used to wrap the final link with a prefix and/or suffix:

- `affix[0]` â†’ prefix (e.g. `"https://host.com/file/"`)
- `affix[1]` â†’ suffix (e.g. `".html"`)

### ğŸ—‘ï¸ `manage_file`

Used for hosts that allow deleting the uploaded file:

- `manage_file[0]` â†’ Delete URL (string, regex, or nested JSON path)
- `manage_file[1]` â†’ HTTP method (`"DELETE"`, `"POST"`...)
- `manage_file[2]` â†’ Delete body content
- `manage_file[3]` â†’ [prefix, suffix] for delete URL

## ğŸ§¨ Special Case: Killcode System

Some hosts (like those using **XFileSharing Pro**) require an extra step with a `killcode` before deletion. This is handled automatically:

```js
if (manage_file[2][key][0] === "killcode") {
  // Logic to extract the file ID
  // Fetch the killcode page
  // Extract killcode and optional token, code or/and rand
}
```

This allows deletion for hosts that use:

- Separate token-based deletion pages
- CSRF-protected forms
- Dynamic or time-based kill links

## ğŸ§ª Examples

### âœ… Example 1: JSON + Direct link

```js
upload_to_host(
  [
    "https://example.com/upload", 
    "POST", 
    formData, 
    { Authorization: "Bearer token" }
  ],
  "json",
  ["data", "url"]
);
```

### âœ… Example 2: Text + Regex match

```js
upload_to_host(
  [
    "https://example.com/upload", 
    "POST", 
    formData
  ],
  "text",
  ["match", /https:\/\/example\.com\/file\/[a-z0-9]+/, 0]
);
```

### âœ… Example 3: Real case (Gofile)

```js
const sent_data_form = new FormData();
sent_data_form.append("file", STATE.file_to_upload);

const headers = api_key_host ? { "Authorization": "Bearer " + api_key_host } : {};

upload_to_host(
  [
    URL_FOR_BYPASS_CORS + "https://upload.gofile.io/uploadfile",
    "POST",
    sent_data_form,
    headers
  ],
  "json",
  ["data", "downloadPage"],
  [],
  api_key_host
  ? [
      "https://api.gofile.io/contents",
      "DELETE",
      {
        "contentsId": ["data", "parentFolder"]
      },
      [],
      headers
    ]
  : [
      "https://api.gofile.io/contents",
      "DELETE",
      {
        "contentsId":["data", "parentFolder"], "token": ["data", "guestToken"]
      }
    ]
);
```